# API Documentation 

## Описание
Этот эндпоинт предназначен для генерации ответа от ИИ на основе предоставленного списка сообщений и выбранного ассистента ИИ. Для корректного ответа от ассистента необходимо передавать всю историю переписки, включая предыдущие сообщения, чтобы ассистент учитывал контекст.

### Эндпоинт
- **URL:** `/generate-ai-response`
- **Метод:** `POST`
- **Модель ответа:** `AIResponse`

---

## Структура запроса

### Тело запроса: `GenerateAIRequestBody`

| Поле       | Тип              | Описание                                             |
|------------|------------------|------------------------------------------------------|
| `messages` | `List[Message]`  | Список сообщений с указанием ролей и содержимого. Включает всю историю общения. |
| `assistant`| `AIAssistant`    | Выбор ассистента ИИ для генерации ответа. Возможные значения: `chat_gpt`, `yandex_gpt` (регистр значения не учитывается). |
| `source`   | `Source`         | Источник запроса. Возможные значения: `youl`, `statuser`, `technokratos_gpt_bot`. |

#### Модели тела запроса

- **`Message`**

  | Поле       | Тип        | Описание                                                  |
  |------------|------------|-----------------------------------------------------------|
  | `role`     | `Role`     | Роль отправителя сообщения. Варианты: `system`, `user`, `assistant`. |
  | `content`  | `str`      | Содержимое сообщения.                                     |

- **`AIAssistant`**

  | Значение        | Описание                                   |
  |-----------------|--------------------------------------------|
  | `chat_gpt`      | Использовать ChatGPT в качестве ассистента ИИ. |
  | `yandex_gpt`    | Использовать Yandex GPT в качестве ассистента ИИ. |

- **`Source`**

  | Значение               | Описание                                   |
  |------------------------|--------------------------------------------|
  | `youl`                 | Запрос от источника Youl.                  |
  | `statuser`             | Запрос от источника Statuser.              |
  | `technokratos_gpt_bot` | Запрос от Technokratos GPT Bot.            |

---

## Структура ответа

### Тело ответа: `AIResponse`

| Поле                | Тип       | Описание                                       |
|---------------------|-----------|-------------------------------------------------|
| `assistant_message` | `str`     | Сгенерированный ответ от ассистента.            |
| `usage`             | `Usage`   | Информация о количестве использованных токенов. |

#### Модели тела ответа

- **`Usage`**

  | Поле               | Тип  | Описание                          |
  |--------------------|------|-----------------------------------|
  | `prompt_tokens`    | `int`| Количество токенов в запросе.     |
  | `completion_tokens`| `int`| Количество токенов в ответе.      |
  | `total_tokens`     | `int`| Общее количество использованных токенов. |

---

## Пример использования

### Запрос
Пример отправки полной истории сообщений, включающей `system`-сообщение, для поддержания контекста при разговоре о функциях банковского приложения:

```json
POST /generate-ai-response
{
  "messages": [
    {"role": "system", "content": "Вы ИИ-ассистент, отвечаете на вопросы о банковском приложении."},
    {"role": "user", "content": "Привет, ИИ!"},
    {"role": "assistant", "content": "Привет! Чем могу помочь?"},
    {"role": "user", "content": "Можешь рассказать, как перевести деньги?"},
    {"role": "assistant", "content": "Конечно! В разделе 'Переводы' выберите получателя и введите сумму."},
    {"role": "user", "content": "Есть ли комиссии за переводы?"}
  ],
  "assistant": "yandex_gpt",
  "source": "technokratos_gpt_bot"
}
```

### Ответ

```json
{
  "assistant_message": "В зависимости от вашего тарифного плана, переводы могут быть бесплатными или с небольшой комиссией. Пожалуйста, проверьте раздел 'Тарифы' для более точной информации.",
  "usage": {
    "prompt_tokens": 60,
    "completion_tokens": 20,
    "total_tokens": 80
  }
}
```